---
sidebar_position: 3
---

# From Unity to Grafana

:::danger
Before proceeding, make sure you meet the [**requirements**](base-config.mdx#requirements) and have completed the [**base configuration**](base-config.mdx).
:::

This documentation explains the integration process between **Unity WebGL** and **Grafana** dashboards using **custom events**.\
The main goal is to send interaction data from Unity (e.g., clicked objects) to Grafana, so dashboards can dynamically update and visualize DT information.

## In Unity

### Creating a JavaScript Library (JSLib)

To enable communication between Unity and Grafana, create a **.jslib** file inside the directory:

    Assets/Plugins/WebGL

:::danger
The folder names must match exactly. If any folder is missing, create it manually, otherwise **the plugin will not work**.
:::

The JSLib file structure should be:

``` js title=grafana-plugin.jslib
mergeInto(LibraryManager.library, {
  <eventName>: function (<paramName>) {
    dispatchReactUnityEvent(
      "<eventName>", 
      <paramName>);
  }
});
```

#### Example JSLib file

``` js title=grafana-plugin.jslib
mergeInto(LibraryManager.library, {
  GetData: function (deviceId) {
    dispatchReactUnityEvent(
      "GetData", 
      Pointer_stringify(deviceId));
  }
});
```
-   The first parameter (`"GetData"`) is the event name (`<eventName>`). It is recommended (but not required) that this matches the function name.
-   The second parameter (`deviceId`) matches the function parameter (`<paramName>`).
    -   For **strings**, wrap with `Pointer_stringify` to ensure correct transmission. (an integer will be sent otherwise)
    -   For **numeric values**, you can pass the parameter directly without conversion.

### Sending Events

Inside a Unity C# script, declare the external method to call the JSLib function. 
This must be placed inside the class, but outside methods such as `Start()` or `Update()`:

``` csharp
#if UNITY_WEBGL && !UNITY_EDITOR
    [DllImport("__Internal")]
    private static extern void GetData(string deviceId);
#else
    private static void GetData(string deviceId){
        Debug.Log("No data");
    }
#endif
```

-   In **WebGL builds**, `GetData` is imported from the JavaScript plugin.
-   In **Unity Editor**, a placeholder is defined to prevent runtime errors.

**Example usage**  
Sending the identifier of a `GameObject` to Grafana:

```csharp
void SendEventWithId(GameObject go){
    if(go != null){
        GetData(go.name);
    }
}
```

**Complete script example**  

Detect clicks on 3D objects and send the object name to Grafana:

``` csharp
using System.Runtime.InteropServices;
using UnityEngine;

public class ObjectClicker : MonoBehaviour
{
    #if UNITY_WEBGL && !UNITY_EDITOR
        [DllImport("__Internal")]
        private static extern void GetData(string deviceId);
    #else
        private static void GetData(string deviceId){
            Debug.Log("No data");
        }
    #endif

    void Update(){
        if (Input.GetMouseButtonDown(0)){
            Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
            if (Physics.Raycast(ray, out RaycastHit hit, 100.0f)){
                if (hit.transform != null){
                    SendEventWithId(hit.transform.gameObject);
                }
            }
        }
    }

    void SendEventWithId(GameObject go){
        if(go != null){
            GetData(go.name);
        }
    }
}
```

If this script is attached to the Main Camera, then whenever a user clicks on a Unity object, the object's name will be dispatched as a `GetData` event to Grafana.

:::info
This is an example using object clicks in Unity, but **events can be triggered from any Unity action and from any GameObject**.
:::

## In Grafana

### Creating a variable

You must [create a variable](https://grafana.com/docs/grafana/latest/dashboards/variables/add-template-variables/) of type **Text Box** or **Constant** to receive the value sent from Unity.

1.  Open `Dashboard Settings`.
2.  Go to **Variables** → click `New variable`.
3.  Select **Text Box** or **Constant** as type.
4.  Enter the variable name (e.g., **thingId**).
5. (Optional) If using **Text Box**, you can configure **Show on dashboard** → **Nothing** to hide the variable from end users. For debugging, it is recommended to keep it visible and hide it later if necessary.  
6.  Click `Apply` → `Save Dashboard`.

### Configuring the panel

In the Grafana panel, configure the **Receive data from Unity** section by adding a new event:

-   Event name (e.g., `GetData`).
-   Data type expected.
-   Variable to update (the one created earlier).

For more details on available modes and configuration fields, see the [Unity plugin options documentation](plugin-docs.mdx).

### Using the Variable in Queries

The Unity `GetData` event dynamically updates the Grafana variable. You can use it directly in queries:

``` sql
from(bucket: "opentwins")
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r["_measurement"] == "mqtt_consumer")
  |> filter(fn: (r) => r["thingId"] == "${thingId}")
  |> keep(columns: ["_time", "_value", "_field"])
```

Here, `${thingId}` will update automatically based on Unity interactions. 



